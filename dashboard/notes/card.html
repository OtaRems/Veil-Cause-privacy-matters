<script src="notes/notelist.js"></script>
<script src="notes/addnote.js"></script>
<div id="notecont">
  <h4 class='ps-4 pt-4 evidtext'><b>Note</b></h4>
  <div class="dropdown position-absolute top-0 end-0 m-4" id="filtronote" >
    <button class="btn btn-outline-secondary btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown">tutte</button>
    <ul class="dropdown-menu" style="--bs-dropdown-min-width: 6rem;">
      <li><a class="dropdown-item notegroup-0" href="#" data-value="0">tutte</a></li>
      <li><a class="dropdown-item notegroup-1" href="#" data-value="1">⬤</a></li>
      <li><a class="dropdown-item notegroup-2" href="#" data-value="2">⬤</a></li>
      <li><a class="dropdown-item notegroup-3" href="#" data-value="3">⬤</a></li>
      <li><a class="dropdown-item notegroup-4" href="#" data-value="4">⬤</a></li>
      <li><a class="dropdown-item notegroup-5" href="#" data-value="5">⬤</a></li>
    </ul>
  </div>
  <div class='overflow-scroll' style="height: 21rem;">
    <ul id='notelist' class='list-group list-group-flush'>    
    </ul>
  </div>

  <!--Pulsante per aggiungere Note-->  
  <button id="addnotebtn" class="roundbtn">+</button>
</div>

<script>
  var notes
  $( async () => {
    const response = await fetch("notes/logic.php");
    notes = await response.json();
    await addNoteList(notes);

    //tasto per filtrare le note
    $("#filtronote .dropdown-item").on("click", async function(tasto) {
      tasto.preventDefault();
      const value = $(this).data("value");
      const label = $(this).text();
      const groupClass = $(this).attr("class").match(/notegroup-\d/);
      const $button = $("#filtronote button");
      $button.removeClass("notegroup-1 notegroup-2 notegroup-3 notegroup-4 notegroup-5");

      if (groupClass) {
        $button.addClass(groupClass[0]);
      }

      $("#filtronote button").text(label);

      if (value == 0) {
        await addNoteList(notes);
        return;
      }
      var filterednotes = notes.filter(function (el) {
        return el.gruppo == value;
      });
      await addNoteList(filterednotes);
    })
  })

  //spawniamo il popup quando vogliamo aggiungere una nota
  var alertnum = 0
  $("#addnotebtn").on("click", function() {
      addNoteState()
      alertnum++
  })
</script>